## Generator

* USAGE: `generator/criugen.py /path/to/process/dump-images [/path/to/program.json`; so u have to pass path to generated by *criu dump* images folder

### Dependencies

* `python 2.7`
* `pycriu` (see https://github.com/xemul/criu)

### Generate program

Before generating program you have to dump process with `criu dump`, so to 
run script below `criu` must be installed on your system.

You can try it on processes from `../sandbox`:
```bash
# starting from generator dir =)
cd ../../sandbox/files && \
./run.sh && \
cd ../../restorer/generator/ && \
./criugen.py ../../sandbox/files/bin/dump 
```

Sorry for this relative paths =)

### How it works

* Firstly we define set of commands full enough to describe restoration of particular set of resources (for now resources are only: process tree, pids and file descriptors)
* Generator itself reads criu dump images and determines how to lineary (!) order commands to ensure:
    - Context for evaluation command with number `i` is fully setuped by evaluating commands with less indices (`< i`) 
    - Correct evaluating of whole program will lead us to correctly restored process

### Interpreter

### Dependencies

* `g++`
* `make`
* Dependencies included in the sources (you don't have to install them):
    - [googletest 1.7.0](https://github.com/google/googletest)
    - [json11](https://github.com/dropbox/json11)
* Optional:
    - `ccze` for log highlighting (it used in scripts `run.sh` and `run_and_dump.sh` in interpreter folder)

### Build

* run `make all` to build

### Run

Now, given file with commands (e.g. `program.json`) you may try to interpret it. You have two possibilities:

* Just build and run `bin/restorer /path/to/program.json -l /path/to/log.txt`
* Use `run_and_dump.sh` script:
    - install `ccze` (fancy log highlighting =))
    - run command `./run_and_dump.sh /path/to/program.json`
    - you will (hopefully) see some output; it everything went OK resorer log will be shown and after this script will dump recently restored process again to `bin/dump` and to `bin/jsondump` and then it will run *generator* to generate program on that fresh dump; finally script compares initial program given to restorer and program generated on restored process; if there is no difference you will see `EQUAL ==> OK!` or something like this on your terminal

### How it works

Command semantics for now are very close to system calls, so restoring interpreter is very simple:

* Every process in process tree acts as interpreter on restorer stage (I call it *restorer node*)
* Restorer node get commands from initial restorer process (ran by starting `/bin/restorer`) through UNIX socket
* Restorer node evaluates got command simply by calling proper system calls (their `glibc` wrappers)
* Restorer nodes stops it's interpreting work then it gots `CMD_FINI` command


